<?php
$yat_states = array(
  array('init', 'emit_error.Unable to proceed: no HTML, PHP, or YATheme detected',
    array("/^<\\\x3fphp\\s/", 'php', 'push_tag.PHP,add_matched'),
    array('/^{:\s*yatheme\s+off\s*:}/', 'yat_yatheme_off', 'discard_matched'),
    array('/^{:\s*yatheme\s+on\s*:}/', 'init', 'discard_matched'),
    array('/^{:/', 'yat_init', 'add_matched,push_tag.Y_OPEN_YBRACE,emit,pop_tag'),
    array("/^(?sU)(.*)(?={:|<\\\x3fphp\\s)/", 'init', 'push_tag.HTML,add_matched.1,emit,pop_tag'),
    array('/^(?s).*$/', 'init', 'push_tag.HTML,add_matched,emit,pop_tag'),
  ),
  array('php', 'add_matched',
    array('/^{:/', 'php', 'emit_error.Illegal YATheme escape in PHP escape, add_matched'),
    array("/^(?sU).*\\\x3f>/", 'init', 'add_matched,emit,pop_tag'),
    array('/^(?sU).*$/', 'init', 'add_matched,emit,pop_tag'),
  ),
  array('yat_init', 'emit_error.no yat starting token found or bad YATheme command',
    array('/^\s*(guards)\s+/', 'yat_guards', 'push_tag.Y_GUARDS,add_matched.1,emit,pop_tag'),
    array('/^\s*(yatemplate)\s+/', 'yat_template', 'push_tag.Y_YATEMPLATE,add_matched.1,emit,pop_tag'),
    array('/^\s*(yatemplate-content)\b\s*:}/', 'init', 'push_tag.Y_YATEMPLATE_CONTENT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^\s*(authority)\s*/', 'yat_authority', 'push_tag.Y_AUTHORITY,add_matched.1,emit,pop_tag'),
    array('/^\s*(errors)\s+/', 'yat_errors', 'push_tag.Y_ERRORS,add_matched.1,emit,pop_tag'),
    array('/^\s*(php-prefix)\s*:}/', 'yat_php_prefix', 'push_tag.Y_PHP_PREFIX,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag, push_tag.Y_TEXT'),
    array('/^\s*(test)\s+((?Us).*)\s*:}/', 'init', 'push_tag.Y_TEST,add_matched.1,emit,pop_tag, push_tag.Y_TEXT,add_matched.2,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^meta\s+([-\w]+)\s+((?U).*):}/', 'init', 'push_tag.Y_META,add_matched.1,emit,pop_tag, push_tag.Y_TEXT,add_matched.2,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('|^css\s+([-+/\.\w]+)\s+((?Us)[^:]*)\s*:}|', 'init', 'push_tag.Y_CSS,add_matched.1,emit,pop_tag, push_tag.Y_TEXT,add_matched.2,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('|^css\s+([-+/\.\w]+)\s*:}|', 'init', 'push_tag.Y_CSS,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('|^javascript\s+\s*([-+ /\.\w]+)\s*:}|', 'init', 'push_tag.Y_JAVASCRIPT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^\s*(include)\s+/', 'yat_include', 'push_tag.Y_INCLUDE,add_matched.1,emit,pop_tag'),
    array('/^\s*render\s+(meta|css|javascript)\s*:}/', 'init', 'push_tag.Y_RENDER,add_matched.1,emit.pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^\s*((?U)\$[^:]+|[A-Z]\w*::\$[^:]+)\s*\|\s*(((?Us).*)\s*)(?=:})\s*:}/', 'init', 'push_tag.Y_ATTRIBUTE,add_matched.1,emit,pop_tag, push_tag.Y_TEXT,add_matched.3,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^\s*((?U)\$[^:]+|[A-Z]\w*::\$[^:]+)\s*:}/', 'init', 'push_tag.Y_ATTRIBUTE,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^\s*((?U).*)\s*:}/', 'init', 'add_matched.1,emit_error.Syntax Error,empty_buffer, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')
    // array('/^{:\s*()\s*/', '', ''),
  ),

  array('yat_authority', 'emit_error.illegal or improper YATheme authority command',
    array('/^\s*(([A-Z]|ANY)(\s*,\s*([A-Z]|ANY))*)\s*:}/', 'init', 'push_tag.Y_TEXT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')),

  array('yat_errors', 'emit_error.Illegal YATheme errors command or missing terminator',
    array('/^(display|ignore)\s*:}/', 'init', 'push_tag.Y_TEXT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^email\s+([-.\w]+@[-.\w]+)\s*:}/', 'init', 'push_tag.Y_EMAIL,add_literal.email,emit,pop_tag, push_tag.Y_TEXT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')),

  array('yat_guards', 'emit_error.illegal guard command or missing YATheme terminator',
    array('/^\s*(on|off)\s*:}/', 'init', 'push_tag.Y_TEXT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')),
    // array('/^\s*(paranoid|normal|off)\s*:}/', 'init', 'push_tag.Y_TEXT,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')),

  array('yat_include', 'emit_error.illegal YATheme include command or missing terminator',
    array('|^((?U)[-+ /.\w]+)\s*:}|', 'init', 'push_tag.Y_INCLUDE_FILE,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')),

  array('yat_php_prefix', 'emit_error.illegal YATheme php-prefix container or missing termination',
    array('/^\s*{:\s*(end-php-prefix)\s*:}/', 'init', 'emit,pop_tag, push_tag.Y_OPEN_YBRACE,add_literal.{:,emit,pop_tag, push_tag.Y_END_PHP_PREFIX,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array("/^<\\\x3fphp /", 'init', 'empty_buffer,pop_tag,emit_error.Syntax Error: illegal PHP escape encountered in php-prefix'),
    array('/^\s*{:/', 'init', 'empty_buffer,pop_tag,emit_error.Syntax Error: illegal YATheme escape encountered in php-prefix'),
    array('/^((?Us).*)(?={:|<\\\x3fphp\\s)/', 'yat_php_prefix', 'add_matched.1'),
    // array('^/\s*/', '', ''),
    ),

  array('yat_template', 'emit_error.illegal yatemplate command or missing terminator',
    array('|^\s*([-+ /\.\w]+)\b\s*:}|', 'init', 'push_tag.Y_YATEMPLATE_FILE,add_matched.1,emit,pop_tag, push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag')),

  array('yat_yatheme_off', 'emit_error.illegal yatheme command or missing terminator',
    array('/^{:\s*yatheme\s+on\s*:}/', 'init', 'push_tag.Y_TEXT,emit,pop_tag, discard_matched'),
      // 'push_tag.Y_TEXT,emit,pop_tag ,push_tag.Y_OPEN_YBRACE,add_literal.{:, emit,pop_tag ,push_tag.Y_YATHEME,add_literal.yatheme,emit,pop_tag ,push_tag.Y_TEXT,add_literal.on,emit,pop_tag ,push_tag.Y_CLOSE_YBRACE,add_literal.:},emit,pop_tag'),
    array('/^(?s)./', 'yat_yatheme_off', 'add_matched'),),
 );
